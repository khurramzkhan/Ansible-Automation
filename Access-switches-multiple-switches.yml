---
  - name: SERVER-PORT TRUNK CONFIGURATION REQUEST 
    hosts: "{{host}}"
    gather_facts: no
    connection: local

    tasks:
      - name: EXTRACTING CURRENT CONFIGURATION FOR INTERFACE {{ interface1 }}   
        no_log: True
        comware_command:
           command:
               - display interface {{ interface1 }}
           type: display
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        register: print_output_1

      - name: EXTRACTING CURRENT CONFIGURATION FOR INTERFACE {{ interface2 }}
        no_log: True
        comware_command:
           command:
               - display interface {{ interface2 }}
           type: display
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        register: print_output_2
        
      - name: EXTRACTING CURRENT CONFIGURATION FOR INTERFACE {{ interface3 }}  
        no_log: True
        comware_command:
           command:
               - display interface {{ interface3 }}
           type: display
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        register: print_output_3
        
      - name: EXTRACTING CURRENT CONFIGURATION FOR INTERFACE {{ interface4 }} 
        no_log: True
        comware_command:
           command:
               - display interface {{ interface4 }}
           type: display
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        register: print_output_4
  
      - block:
         - name: "CHECKING PORT STATUS FOR {{ interface1 }}"
           debug:
             msg: "PORT {{ interface1 }} IS CURRENTLY IN USE. UNABLE TO CONFIGURE THIS PORT"
        when: '"Current state: UP" in print_output_1.response'
      - name: PORT {{ interface1 }} IS AVAILABLE, BEGINING CONFIGURATION 
        no_log: True
        comware_command:
           command:
                - int {{ interface1 }}
                - undo port link-type
                - undo description
                - undo port access vlan
                - undo stp edged-port 
                - description {{ description1 }}
                - port link-type trunk
                - undo port trunk permit vlan 1
                - port trunk permit vlan 90 100 to 279 282 to 286 928 1100 to 1123 1200 to 1261 1267 to 1286 1291 to 1310 1650 to 1660 1700 to 1707
                - port trunk permit vlan 1750 to 1757 2000 to 2031 2100 to 2131 2200 to 2231 3011 3035 4053 to 4054
                - stp edged-port
                - undo shut 
           type: config
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        when: '"DOWN" in print_output_1.response'
        register: print_output_5

      - block:
         - name: "CHECKING PORT STATUS FOR {{ interface2 }}"
           debug:
             msg: "PORT {{ interface2 }} IS CURRENTLY IN USE. UNABLE TO CONFIGURE THIS PORT"
        when: '"Current state: UP" in print_output_2.response'
      - name: PORT {{ interface2 }} IS AVAILABLE, BEGINING CONFIGURATION 
        no_log: True
        comware_command:
           command:
                - int {{ interface2 }}
                - undo port link-type
                - undo description
                - undo port access vlan
                - undo stp edged-port 
                - port link-mode bridge
                - description {{ description2 }}
                - port link-type trunk
                - undo port trunk permit vlan 1
                - port trunk permit vlan 90 100 to 279 282 to 286 928 1100 to 1123 1200 to 1261 1267 to 1286 1291 to 1310 1650 to 1660 1700 to 1707
                - port trunk permit vlan 1750 to 1757 2000 to 2031 2100 to 2131 2200 to 2231 3011 3035 4053 to 4054
                - stp edged-port
                - undo shut 
           type: config
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        when: '"DOWN" in print_output_1.response'
        register: print_output_6
               
      - block:
         - name: "CHECKING PORT STATUS FOR {{ interface3 }}"
           debug:
             msg: "PORT {{ interface3 }} IS CURRENTLY IN USE. UNABLE TO CONFIGURE THIS PORT"
        when: '"Current state: UP" in print_output_1.response'
      - name: PORT {{ interface3 }} IS AVAILABLE, BEGINING CONFIGURATION 
        no_log: True
        comware_command:
           command:
                - int {{ interface3 }}
                - undo port link-type
                - undo description
                - undo port access vlan
                - undo stp edged-port 
                - port link-mode bridge
                - description {{ description3 }}
                - port link-type trunk
                - undo port trunk permit vlan 1
                - port trunk permit vlan 90 100 to 279 282 to 286 928 1100 to 1123 1200 to 1261 1267 to 1286 1291 to 1310 1650 to 1660 1700 to 1707
                - port trunk permit vlan 1750 to 1757 2000 to 2031 2100 to 2131 2200 to 2231 3011 3035 4053 to 4054
                - stp edged-port
                - undo shut 
           type: config
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        when: '"DOWN" in print_output_3.response'
        register: print_output_7
        
      - block:
         - name: "CHECKING PORT STATUS FOR {{ interface4 }}"
           debug:
             msg: "PORT {{ interface4 }} IS CURRENTLY IN USE. UNABLE TO CONFIGURE THIS PORT"
        when: '"Current state: UP" in print_output_4.response'
      - name: PORT {{ interface4 }} IS AVAILABLE, BEGINING CONFIGURATION 
        no_log: True
        comware_command:
           command:
                - int {{ interface4 }}
                - undo port link-type
                - undo description
                - undo port access vlan
                - undo stp edged-port 
                - port link-mode bridge
                - description {{ description4 }}
                - port link-type trunk
                - undo port trunk permit vlan 1
                - port trunk permit vlan 90 100 to 279 282 to 286 928 1100 to 1123 1200 to 1261 1267 to 1286 1291 to 1310 1650 to 1660 1700 to 1707
                - port trunk permit vlan 1750 to 1757 2000 to 2031 2100 to 2131 2200 to 2231 3011 3035 4053 to 4054
                - stp edged-port
                - undo shut 
           type: config
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        when: '"DOWN" in print_output_4.response'
        register: print_output_8
                      
      - debug:
          msg: "PORT {{ interface1 }} of {{ host }} IS CONFIGURED SUCCESSFULLY AS TRUNK OF {{ description1 }}"
        when: '"DOWN" in print_output_1.response'
      - debug:
          msg: "PORT {{ interface2 }} of {{ host }} IS CONFIGURED SUCCESSFULLY AS TRUNK OF {{ description2 }}"
        when: '"DOWN" in print_output_2.response'
      - debug:
          msg: "PORT {{ interface3 }} of {{ host }} IS CONFIGURED SUCCESSFULLY AS TRUNK OF {{ description3 }}"
        when: '"DOWN" in print_output_3.response'
      - debug:
          msg: "PORT {{ interface4 }} of {{ host }} IS CONFIGURED SUCCESSFULLY AS TRUNK OF {{ description4 }}"
        when: '"DOWN" in print_output_4.response'
      - debug:
          msg: "PORT {{ interface1 }} of {{ host }} IS IN USE AND NOT CONFIGURED"
        when: '"UP" in print_output_1.response'
      - debug:
          msg: "PORT {{ interface2 }} of {{ host }} IS IN USE AND NOT CONFIGURED"
        when: '"UP" in print_output_2.response'
      - debug:
          msg: "PORT {{ interface3 }} of {{ host }} IS IN USE AND NOT CONFIGURED"
        when: '"UP" in print_output_3.response'
      - debug:
          msg: "PORT {{ interface4 }} of {{ host }} IS IN USE AND NOT CONFIGURED"
        when: '"UP" in print_output_4.response'
      - debug:
          msg: "GATHERING REQUIREMENTS FOR SECOND SWITCH {{ secondhost }}"
        register: print_output_20 
      - block:
         - debug:
             msg: "NO CONFIGURATION REQUIRED ON SECOND SWITCH - ENDING REQUEST"
         - meta: end_play
        when: '"not required" in print_output_20.msg' 
    
      - name: EXTRACTING CURRENT CONFIGURATION FOR INTERFACE {{ interface5 }}   
        no_log: True
        comware_command:
           command:
               - display interface {{ interface5 }}
           type: display
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        register: print_output_25

      - name: EXTRACTING CURRENT CONFIGURATION FOR INTERFACE {{ interface6 }}
        no_log: True
        comware_command:
           command:
               - display interface {{ interface6 }}
           type: display
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        register: print_output_26
        
      - name: EXTRACTING CURRENT CONFIGURATION FOR INTERFACE {{ interface7 }}  
        no_log: True
        comware_command:
           command:
               - display interface {{ interface27 }}
           type: display
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        register: print_output_27
        
      - name: EXTRACTING CURRENT CONFIGURATION FOR INTERFACE {{ interface8 }} 
        no_log: True
        comware_command:
           command:
               - display interface {{ interface8 }}
           type: display
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        register: print_output_28
  
      - block:
         - name: "CHECKING PORT STATUS FOR {{ interface5 }}"
           debug:
             msg: "PORT {{ interface5 }} IS CURRENTLY IN USE. UNABLE TO CONFIGURE THIS PORT"
        when: '"Current state: UP" in print_output_25.response'
      - name: PORT {{ interface5 }} IS AVAILABLE, BEGINING CONFIGURATION 
        no_log: True
        comware_command:
           command:
                - int {{ interface5 }}
                - undo port link-type
                - undo description
                - undo port access vlan
                - undo stp edged-port 
                - description {{ description1 }}
                - port link-type trunk
                - undo port trunk permit vlan 1
                - port trunk permit vlan 90 100 to 279 282 to 286 928 1100 to 1123 1200 to 1261 1267 to 1286 1291 to 1310 1650 to 1660 1700 to 1707
                - port trunk permit vlan 1750 to 1757 2000 to 2031 2100 to 2131 2200 to 2231 3011 3035 4053 to 4054
                - stp edged-port
                - undo shut 
           type: config
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        when: '"DOWN" in print_output_1.response'
        register: print_output_35

      - block:
         - name: "CHECKING PORT STATUS FOR {{ interface6 }}"
           debug:
             msg: "PORT {{ interface26 }} IS CURRENTLY IN USE. UNABLE TO CONFIGURE THIS PORT"
        when: '"Current state: UP" in print_output_2.response'
      - name: PORT {{ interface6 }} IS AVAILABLE, BEGINING CONFIGURATION 
        no_log: True
        comware_command:
           command:
                - int {{ interface6 }}
                - undo port link-type
                - undo description
                - undo port access vlan
                - undo stp edged-port 
                - port link-mode bridge
                - description {{ description2 }}
                - port link-type trunk
                - undo port trunk permit vlan 1
                - port trunk permit vlan 90 100 to 279 282 to 286 928 1100 to 1123 1200 to 1261 1267 to 1286 1291 to 1310 1650 to 1660 1700 to 1707
                - port trunk permit vlan 1750 to 1757 2000 to 2031 2100 to 2131 2200 to 2231 3011 3035 4053 to 4054
                - stp edged-port
                - undo shut 
           type: config
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        when: '"DOWN" in print_output_26.response'
        register: print_output_36
               
      - block:
         - name: "CHECKING PORT STATUS FOR {{ interface7 }}"
           debug:
             msg: "PORT {{ interface7 }} IS CURRENTLY IN USE. UNABLE TO CONFIGURE THIS PORT"
        when: '"Current state: UP" in print_output_27.response'
      - name: PORT {{ interface7 }} IS AVAILABLE, BEGINING CONFIGURATION 
        no_log: True
        comware_command:
           command:
                - int {{ interface7 }}
                - undo port link-type
                - undo description
                - undo port access vlan
                - undo stp edged-port 
                - port link-mode bridge
                - description {{ description3 }}
                - port link-type trunk
                - undo port trunk permit vlan 1
                - port trunk permit vlan 90 100 to 279 282 to 286 928 1100 to 1123 1200 to 1261 1267 to 1286 1291 to 1310 1650 to 1660 1700 to 1707
                - port trunk permit vlan 1750 to 1757 2000 to 2031 2100 to 2131 2200 to 2231 3011 3035 4053 to 4054
                - stp edged-port
                - undo shut 
           type: config
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        when: '"DOWN" in print_output_3.response'
        register: print_output_37
        
      - block:
         - name: "CHECKING PORT STATUS FOR {{ interface8 }}"
           debug:
             msg: "PORT {{ interface8 }} IS CURRENTLY IN USE. UNABLE TO CONFIGURE THIS PORT"
        when: '"Current state: UP" in print_output_28.response'
      - name: PORT {{ interface8 }} IS AVAILABLE, BEGINING CONFIGURATION 
        no_log: True
        comware_command:
           command:
                - int {{ interface8 }}
                - undo port link-type
                - undo description
                - undo port access vlan
                - undo stp edged-port 
                - port link-mode bridge
                - description {{ description4 }}
                - port link-type trunk
                - undo port trunk permit vlan 1
                - port trunk permit vlan 90 100 to 279 282 to 286 928 1100 to 1123 1200 to 1261 1267 to 1286 1291 to 1310 1650 to 1660 1700 to 1707
                - port trunk permit vlan 1750 to 1757 2000 to 2031 2100 to 2131 2200 to 2231 3011 3035 4053 to 4054
                - stp edged-port
                - undo shut 
           type: config
           username: "{{ username }}"
           password: "{{ password }}"
           hostname: "{{ inventory_hostname }}"
        when: '"DOWN" in print_output_4.response'
        register: print_output_38
                      
      - debug:
          msg: "PORT {{ interface5 }} of {{ secondhost }} IS CONFIGURED SUCCESSFULLY AS TRUNK OF {{ description5 }}"
        when: '"DOWN" in print_output_25.response'
      - debug:
          msg: "PORT {{ interface6 }} of {{ secondhost }} IS CONFIGURED SUCCESSFULLY AS TRUNK OF {{ description6 }}"
        when: '"DOWN" in print_output_26.response'
      - debug:
          msg: "PORT {{ interface7 }} of {{ secondhost }} IS CONFIGURED SUCCESSFULLY AS TRUNK OF {{ description7 }}"
        when: '"DOWN" in print_output_27.response'
      - debug:
          msg: "PORT {{ interface8 }} of {{ secondhost }} IS CONFIGURED SUCCESSFULLY AS TRUNK OF {{ description8 }}"
        when: '"DOWN" in print_output_28.response'
      - debug:
          msg: "PORT {{ interface5 }} of {{ secondhost }} IS IN USE AND NOT CONFIGURED"
        when: '"UP" in print_output_25.response'
      - debug:
          msg: "PORT {{ interface6 }} of {{ secondhost }} IS IN USE AND NOT CONFIGURED"
        when: '"UP" in print_output_26.response'
      - debug:
          msg: "PORT {{ interface7 }} of {{ secondhost }} IS IN USE AND NOT CONFIGURED"
        when: '"UP" in print_output_27.response'
      - debug:
          msg: "PORT {{ interface8 }} of {{ secondhost }} IS IN USE AND NOT CONFIGURED"
        when: '"UP" in print_output_28.response'
    
    
    
